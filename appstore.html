<!DOCTYPE html>

<html lang="en">

<head>

&nbsp;   <meta charset="UTF-8">

&nbsp;   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

&nbsp;   <meta name="apple-mobile-web-app-capable" content="yes">

&nbsp;   <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

&nbsp;   <title>Isaahi App Store</title>

&nbsp;   <script src="https://cdn.tailwindcss.com"></script>

&nbsp;   <style>

&nbsp;       :root {

&nbsp;           --bg-color: #ffffff;

&nbsp;           --bg-secondary: #f2f2f7;

&nbsp;           --text-primary: #1c1c1e;

&nbsp;           --text-secondary: #8e8e93;

&nbsp;           --accent: #007aff;

&nbsp;           --danger: #ff3b30;

&nbsp;           --safe-bottom: env(safe-area-inset-bottom);

&nbsp;           --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);

&nbsp;       }

&nbsp;       body {

&nbsp;           font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

&nbsp;           background-color: var(--bg-color);

&nbsp;           color: var(--text-primary);

&nbsp;           margin: 0; padding: 0;

&nbsp;           height: 100vh; width: 100vw;

&nbsp;           overflow: hidden;

&nbsp;           -webkit-tap-highlight-color: transparent;

&nbsp;       }

&nbsp;       #main-view { height: 100%; overflow-y: auto; padding-bottom: calc(100px + var(--safe-bottom)); scroll-behavior: smooth; }

&nbsp;       

&nbsp;       /\* Modern Header \*/

&nbsp;       .header { 

&nbsp;           position: sticky; top: 0; z-index: 40; 

&nbsp;           background: rgba(255,255,255,0.85); 

&nbsp;           backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);

&nbsp;           border-bottom: 0.5px solid rgba(0,0,0,0.05); 

&nbsp;           display: flex; justify-content: space-between; align-items: center; 

&nbsp;           padding: 12px 20px; 

&nbsp;       }

&nbsp;       .header h1 { font-size: 32px; font-weight: 800; letter-spacing: -1px; }



&nbsp;       /\* Navigation Tab Bar \*/

&nbsp;       .tab-bar { 

&nbsp;           position: fixed; bottom: 0; width: 100%; 

&nbsp;           background: rgba(255,255,255,0.9); 

&nbsp;           backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);

&nbsp;           border-top: 0.5px solid rgba(0,0,0,0.1); 

&nbsp;           display: flex; justify-content: space-around; 

&nbsp;           padding-bottom: calc(5px + var(--safe-bottom)); 

&nbsp;           padding-top: 8px;

&nbsp;           z-index: 50; 

&nbsp;       }

&nbsp;       .tab-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; font-weight: 600; color: var(--text-secondary); cursor: pointer; transition: color 0.2s; }

&nbsp;       .tab-item.active { color: var(--accent); }

&nbsp;       .tab-item svg { margin-bottom: 4px; transition: transform 0.2s; }

&nbsp;       .tab-item:active svg { transform: scale(0.9); }



&nbsp;       /\* Premium App Cards \*/

&nbsp;       .app-card { background: white; border-radius: 28px; margin-bottom: 24px; overflow: hidden; box-shadow: var(--card-shadow); transition: transform 0.3s ease; }

&nbsp;       .app-card:active { transform: scale(0.98); }

&nbsp;       

&nbsp;       .app-icon { 

&nbsp;           width: 60px; height: 60px; border-radius: 16px; flex-shrink: 0; 

&nbsp;           display: flex; align-items: center; justify-content: center; 

&nbsp;           color: white; font-size: 26px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);

&nbsp;       }

&nbsp;       .app-icon.sm { width: 48px; height: 48px; border-radius: 12px; font-size: 20px; }

&nbsp;       .app-icon.lg { width: 110px; height: 110px; border-radius: 24px; font-size: 48px; }



&nbsp;       /\* Layering for Views \*/

&nbsp;       .view-layer { position: fixed; inset: 0; background: white; z-index: 100; transform: translateY(100%); transition: transform 0.45s cubic-bezier(0.19, 1, 0.22, 1); display: flex; flex-direction: column; }

&nbsp;       .view-layer.open { transform: translateY(0); }

&nbsp;       

&nbsp;       /\* App Runner Overlay \*/

&nbsp;       #app-runner { position: fixed; inset: 0; background: black; z-index: 1000; display: none; flex-direction: column; }

&nbsp;       #app-runner iframe { flex: 1; border: none; background: white; border-radius: 0; }



&nbsp;       /\* Modals \*/

&nbsp;       .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 200; display: none; align-items: center; justify-content: center; animation: fadeIn 0.3s; }

&nbsp;       .modal-card { background: white; width: 90%; max-width: 400px; border-radius: 32px; padding: 28px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }



&nbsp;       /\* UI Elements \*/

&nbsp;       input, textarea, select { 

&nbsp;           width: 100%; padding: 16px; border-radius: 14px; 

&nbsp;           background: #f2f2f7; border: 1.5px solid transparent; 

&nbsp;           font-size: 16px; margin-bottom: 14px; transition: all 0.2s;

&nbsp;           outline: none;

&nbsp;       }

&nbsp;       input:focus, textarea:focus { background: white; border-color: var(--accent); box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1); }

&nbsp;       

&nbsp;       .btn-primary { width: 100%; padding: 18px; border-radius: 18px; font-weight: 700; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }

&nbsp;       .btn-primary:active { transform: scale(0.96); opacity: 0.85; }

&nbsp;       

&nbsp;       .external-link-badge { font-size: 10px; font-weight: 800; background: rgba(0, 122, 255, 0.08); color: var(--accent); padding: 4px 10px; border-radius: 20px; display: inline-flex; align-items: center; gap: 4px; margin-top: 6px; text-transform: uppercase; letter-spacing: 0.5px; }



&nbsp;       /\* Animations \*/

&nbsp;       @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

&nbsp;       @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

&nbsp;       

&nbsp;       .loading-overlay { position: fixed; inset: 0; background: white; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }

&nbsp;       .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; animation: spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite; }

&nbsp;       @keyframes spin { to { transform: rotate(360deg); } }

&nbsp;   </style>

</head>

<body>



<div id="loading-screen" class="loading-overlay">

&nbsp;   <div class="spinner"></div>

&nbsp;   <p class="mt-6 text-gray-400 font-bold text-xs tracking-\[0.2em] uppercase">Isaahi Cloud Link</p>

</div>



<div id="app-container">

&nbsp;   <div id="main-view"></div>

&nbsp;   <nav class="tab-bar">

&nbsp;       <div class="tab-item active" onclick="router('today')"><svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H7v-2h5v2zm5-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>Today</div>

&nbsp;       <div class="tab-item" onclick="router('apps')"><svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M4 4h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 10h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 16h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4z"/></svg>Apps</div>

&nbsp;       <div class="tab-item" onclick="router('publish')"><svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg>Publish</div>

&nbsp;       <div class="tab-item" onclick="router('search')"><svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>Search</div>

&nbsp;   </nav>

</div>



<div id="detail-view" class="view-layer">

&nbsp;   <div class="p-6 flex flex-col h-full overflow-y-auto">

&nbsp;       <button onclick="closeDetail()" class="text-blue-500 font-black flex items-center mb-8 bg-blue-50 self-start px-4 py-2 rounded-full active:scale-95 transition-transform"><svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="4" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg> BACK</button>

&nbsp;       <div id="detail-content"></div>

&nbsp;   </div>

</div>



<div id="app-runner">

&nbsp;   <div class="bg-gray-900 text-white p-4 flex justify-between items-center shadow-lg">

&nbsp;       <span id="runner-title" class="font-bold truncate max-w-\[200px] text-sm">App Runner</span>

&nbsp;       <button onclick="closeAppRunner()" class="bg-red-500 px-6 py-1.5 rounded-full text-\[11px] font-black uppercase tracking-wider active:scale-90 transition-transform">Close App</button>

&nbsp;   </div>

&nbsp;   <iframe id="runner-frame" sandbox="allow-scripts allow-forms allow-modals"></iframe>

</div>



<div id="modal-overlay" class="modal-overlay" onclick="if(event.target===this) this.style.display='none'">

&nbsp;   <div class="modal-card" id="modal-content"></div>

</div>



<script type="module">

&nbsp;   import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

&nbsp;   import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

&nbsp;   import { getFirestore, collection, doc, setDoc, getDoc, addDoc, updateDoc, deleteDoc, onSnapshot, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";



&nbsp;   const firebaseConfig = JSON.parse(\_\_firebase\_config);

&nbsp;   const app = initializeApp(firebaseConfig);

&nbsp;   const auth = getAuth(app);

&nbsp;   const db = getFirestore(app);

&nbsp;   const appId = typeof \_\_app\_id !== 'undefined' ? \_\_app\_id : 'isaahi-store';



&nbsp;   let user = null;

&nbsp;   let apps = \[];

&nbsp;   let currentApp = null;

&nbsp;   let uploadedFile = null;



&nbsp;   // --- Core Startup ---

&nbsp;   async function init() {

&nbsp;       const token = typeof \_\_initial\_auth\_token !== 'undefined' ? \_\_initial\_auth\_token : null;

&nbsp;       if (token) await signInWithCustomToken(auth, token);

&nbsp;       else await signInAnonymously(auth);



&nbsp;       onAuthStateChanged(auth, (u) => {

&nbsp;           user = u;

&nbsp;           document.getElementById('loading-screen').style.display = 'none';

&nbsp;           ensureDefaultStoreApp();

&nbsp;           router('today');

&nbsp;       });



&nbsp;       const appsRef = collection(db, 'artifacts', appId, 'public', 'data', 'apps');

&nbsp;       onSnapshot(appsRef, (snap) => {

&nbsp;           apps = snap.docs.map(d => ({ id: d.id, ...d.data() }));

&nbsp;           apps.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));

&nbsp;           renderCurrentView();

&nbsp;       });

&nbsp;   }



&nbsp;   async function ensureDefaultStoreApp() {

&nbsp;       const storeUrl = "https://raahialt1-png.github.io/Isaahi-AppStore/";

&nbsp;       const appsRef = collection(db, 'artifacts', appId, 'public', 'data', 'apps');

&nbsp;       const q = await getDocs(appsRef);

&nbsp;       const found = q.docs.some(d => d.data().appUrl === storeUrl);

&nbsp;       if (!found) {

&nbsp;           await addDoc(appsRef, {

&nbsp;               name: "Isaahi App Store",

&nbsp;               developerName: "raahialt1-png",

&nbsp;               description: "The official web hub for Isaahi apps. Publish and discover web apps instantly.",

&nbsp;               appUrl: storeUrl,

&nbsp;               icon: "üè¨",

&nbsp;               color: "bg-blue-600",

&nbsp;               ownerId: "system",

&nbsp;               createdAt: serverTimestamp()

&nbsp;           });

&nbsp;       }

&nbsp;   }



&nbsp;   window.router = (view) => {

&nbsp;       window.currentView = view;

&nbsp;       renderCurrentView();

&nbsp;   }



&nbsp;   function renderCurrentView() {

&nbsp;       const view = window.currentView || 'today';

&nbsp;       const main = document.getElementById('main-view');

&nbsp;       document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));

&nbsp;       const tab = document.querySelector(`.tab-item\[onclick\*="${view}"]`);

&nbsp;       if(tab) tab.classList.add('active');

&nbsp;       

&nbsp;       const profileInitials = user \&\& !user.isAnonymous ? "OK" : "IA";

&nbsp;       const profileIcon = `<div onclick="openAccount()" class="w-10 h-10 rounded-full ${user \&\& !user.isAnonymous ? 'bg-blue-600' : 'bg-gray-200 text-gray-400'} text-white flex items-center justify-center text-\[10px] font-black cursor-pointer transition-transform active:scale-90 shadow-md">${profileInitials}</div>`;



&nbsp;       if (view === 'today') {

&nbsp;           const hero = apps\[0];

&nbsp;           main.innerHTML = `

&nbsp;               <div class="header"><h1>Today</h1>${profileIcon}</div>

&nbsp;               <div class="p-6">

&nbsp;                   ${hero ? `

&nbsp;                   <div class="app-card relative h-\[460px] cursor-pointer overflow-hidden" onclick="openDetail('${hero.id}')">

&nbsp;                       <div class="absolute inset-0 ${hero.color || 'bg-blue-500'} opacity-95"></div>

&nbsp;                       <div class="absolute bottom-0 left-0 right-0 p-8 text-white bg-gradient-to-t from-black/70 via-black/30 to-transparent">

&nbsp;                           <span class="text-\[10px] font-black uppercase tracking-\[0.2em] opacity-80 mb-2 block">App of the Day</span>

&nbsp;                           <h2 class="text-4xl font-black my-2 leading-tight">${hero.name}</h2>

&nbsp;                           <p class="text-sm font-medium opacity-90 line-clamp-2">${hero.description}</p>

&nbsp;                           ${hero.appUrl.startsWith('http') ? `

&nbsp;                           <div class="mt-5 flex items-center gap-2">

&nbsp;                               <div class="text-\[9px] bg-white/20 border border-white/20 px-3 py-1.5 rounded-full inline-flex items-center gap-1.5 font-black uppercase tracking-tighter backdrop-blur-md">

&nbsp;                                   <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg> 

&nbsp;                                   ${new URL(hero.appUrl).hostname}

&nbsp;                               </div>

&nbsp;                           </div>` : ''}

&nbsp;                       </div>

&nbsp;                   </div>` : '<div class="h-96 flex items-center justify-center text-gray-400 font-bold uppercase tracking-widest">Loading...</div>'}

&nbsp;                   <h2 class="mt-12 mb-6 text-2xl font-black tracking-tight">Top Picks</h2>

&nbsp;                   <div class="space-y-2">

&nbsp;                       ${apps.slice(1, 30).map(a => renderListItem(a)).join('')}

&nbsp;                   </div>

&nbsp;               </div>`;

&nbsp;       } else if (view === 'apps') {

&nbsp;           main.innerHTML = `<div class="header"><h1>Apps</h1>${profileIcon}</div><div class="p-6 space-y-2">${apps.map(a => renderListItem(a)).join('')}</div>`;

&nbsp;       } else if (view === 'publish') {

&nbsp;           if (!user || user.isAnonymous) {

&nbsp;               main.innerHTML = `<div class="header"><h1>Publish</h1>${profileIcon}</div><div class="p-12 text-center h-full flex flex-col justify-center">

&nbsp;                   <div class="w-24 h-24 bg-gray-100 rounded-\[32px] mx-auto mb-8 flex items-center justify-center text-gray-300 text-4xl">üîê</div>

&nbsp;                   <h2 class="text-2xl font-black">Developer Login</h2>

&nbsp;                   <p class="text-gray-500 mb-8 max-w-\[240px] mx-auto text-sm leading-relaxed">Join our developer community to publish your web apps to Isaahi.</p>

&nbsp;                   <button onclick="openAuth()" class="btn-primary bg-blue-600 text-white shadow-xl shadow-blue-200">Sign In to Continue</button>

&nbsp;               </div>`;

&nbsp;               return;

&nbsp;           }

&nbsp;           main.innerHTML = `

&nbsp;               <div class="header"><h1>Publish</h1>${profileIcon}</div>

&nbsp;               <div class="p-6">

&nbsp;                   <form id="publish-form" class="space-y-2">

&nbsp;                       <div><label class="text-\[10px] font-black text-gray-400 uppercase tracking-widest ml-1 mb-2 block">App Name</label><input id="p-name" required placeholder="Name your app"></div>

&nbsp;                       <div><label class="text-\[10px] font-black text-gray-400 uppercase tracking-widest ml-1 mb-2 block">HTML Source</label>

&nbsp;                           <div class="file-upload-box border-2 border-dashed border-gray-200 rounded-\[20px] p-10 text-center bg-gray-50 relative hover:border-blue-400 transition-colors">

&nbsp;                               <span id="file-status" class="text-xs text-gray-400 font-bold uppercase tracking-wide">Drop HTML file here</span>

&nbsp;                               <input type="file" id="p-file" accept=".html" class="absolute inset-0 opacity-0 cursor-pointer">

&nbsp;                           </div>

&nbsp;                       </div>

&nbsp;                       <div><label class="text-\[10px] font-black text-gray-400 uppercase tracking-widest ml-1 mb-2 block">External URL</label><input id="p-url" placeholder="https://example.com"></div>

&nbsp;                       <div><label class="text-\[10px] font-black text-gray-400 uppercase tracking-widest ml-1 mb-2 block">Description</label><textarea id="p-desc" required rows="4" placeholder="Describe your app..."></textarea></div>

&nbsp;                       <div class="grid grid-cols-2 gap-4">

&nbsp;                           <div><label class="text-\[10px] font-black text-gray-400 uppercase tracking-widest ml-1 mb-2 block">Icon (Emoji)</label><input id="p-icon" value="üöÄ"></div>

&nbsp;                           <div><label class="text-\[10px] font-black text-gray-400 uppercase tracking-widest ml-1 mb-2 block">Branding</label>

&nbsp;                               <select id="p-color">

&nbsp;                                   <option value="bg-blue-600">Ocean Blue</option>

&nbsp;                                   <option value="bg-red-500">Pulse Red</option>

&nbsp;                                   <option value="bg-green-500">Leaf Green</option>

&nbsp;                                   <option value="bg-purple-600">Deep Purple</option>

&nbsp;                                   <option value="bg-orange-500">Sunset Orange</option>

&nbsp;                               </select>

&nbsp;                           </div>

&nbsp;                       </div>

&nbsp;                       <button type="submit" class="btn-primary bg-blue-600 text-white mt-10 shadow-2xl shadow-blue-200">Publish App</button>

&nbsp;                   </form>

&nbsp;               </div>`;

&nbsp;           setupPublishForm();

&nbsp;       } else if (view === 'search') {

&nbsp;           main.innerHTML = `<div class="header"><h1>Search</h1>${profileIcon}</div><div class="p-6"><input id="search-input" placeholder="Search Isaahi Market..." class="mb-8 p-5 bg-white border border-gray-100 shadow-sm"><div id="results" class="space-y-2"></div></div>`;

&nbsp;           document.getElementById('search-input').oninput = (e) => {

&nbsp;               const q = e.target.value.toLowerCase();

&nbsp;               const res = apps.filter(a => a.name.toLowerCase().includes(q) || a.developerName?.toLowerCase().includes(q));

&nbsp;               document.getElementById('results').innerHTML = res.map(a => renderListItem(a)).join('');

&nbsp;           };

&nbsp;       }

&nbsp;   }



&nbsp;   function renderListItem(a) {

&nbsp;       let externalHint = "";

&nbsp;       if (a.appUrl \&\& a.appUrl.startsWith('http')) {

&nbsp;           try {

&nbsp;               const url = new URL(a.appUrl);

&nbsp;               externalHint = `<div class="external-link-badge"><svg class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg> ${url.hostname}</div>`;

&nbsp;           } catch(e) {}

&nbsp;       }



&nbsp;       return `<div class="flex items-center gap-5 py-4 px-2 border-b border-gray-50 active:bg-gray-100/50 rounded-2xl transition-all" onclick="openDetail('${a.id}')">

&nbsp;           <div class="app-icon sm ${a.color || 'bg-blue-600'}">${a.icon || 'üöÄ'}</div>

&nbsp;           <div class="flex-1 min-w-0">

&nbsp;               <h3 class="text-\[15px] text-gray-900 font-bold truncate leading-tight">${a.name}</h3>

&nbsp;               <p class="text-\[12px] text-gray-400 font-medium truncate">${a.developerName || 'Unknown'}</p>

&nbsp;               ${externalHint}

&nbsp;           </div>

&nbsp;           <button class="bg-blue-50 text-blue-600 px-6 py-1.5 rounded-full text-\[11px] font-black uppercase tracking-tight active:scale-90 transition-transform" onclick="event.stopPropagation(); openGetModal('${a.id}')">GET</button>

&nbsp;       </div>`;

&nbsp;   }



&nbsp;   window.openDetail = (id) => {

&nbsp;       const app = apps.find(a => a.id === id);

&nbsp;       currentApp = app;

&nbsp;       const isOwner = user \&\& app.ownerId === user.uid;

&nbsp;       document.getElementById('detail-content').innerHTML = `

&nbsp;           <div class="flex gap-6 items-end mb-10">

&nbsp;               <div class="app-icon lg ${app.color}">${app.icon}</div>

&nbsp;               <div class="flex-1 min-w-0">

&nbsp;                   <h2 class="text-3xl font-black tracking-tight leading-tight">${app.name}</h2>

&nbsp;                   <p class="text-gray-400 font-semibold text-base mt-1">${app.developerName}</p>

&nbsp;                   <button class="bg-blue-600 text-white px-12 py-2.5 rounded-full text-sm font-black mt-4 shadow-xl shadow-blue-100 active:scale-95 transition-transform" onclick="openGetModal('${app.id}')">GET</button>

&nbsp;               </div>

&nbsp;           </div>

&nbsp;           <div class="flex border-y border-gray-100 py-8 mb-10 justify-around text-center">

&nbsp;               <div><p class="text-\[10px] font-black text-gray-400 uppercase tracking-\[0.2em] mb-2">Rank</p><p class="text-2xl font-black text-gray-900">#${Math.floor(Math.random()\*15)+1}</p></div>

&nbsp;               <div><p class="text-\[10px] font-black text-gray-400 uppercase tracking-\[0.2em] mb-2">Age</p><p class="text-2xl font-black text-gray-900">4+</p></div>

&nbsp;               <div><p class="text-\[10px] font-black text-gray-400 uppercase tracking-\[0.2em] mb-2">Status</p><p class="text-2xl font-black text-green-500">Live</p></div>

&nbsp;           </div>

&nbsp;           <h3 class="text-xl font-black mb-4">What's New</h3>

&nbsp;           <p class="text-gray-600 leading-relaxed text-\[15px] mb-10">Version 1.0.0 - Launching on Isaahi App Store. New UI improvements and stability fixes.</p>

&nbsp;           

&nbsp;           <h3 class="text-xl font-black mb-4">Description</h3>

&nbsp;           <p class="text-gray-500 leading-relaxed whitespace-pre-wrap text-\[15px] mb-16">${app.description}</p>

&nbsp;           

&nbsp;           ${isOwner ? `<button id="del-btn" class="btn-primary bg-red-500 text-white shadow-2xl shadow-red-100 mb-10 uppercase tracking-widest text-xs">Permanently Delete App</button>` : ''}

&nbsp;       `;

&nbsp;       if (isOwner) document.getElementById('del-btn').onclick = () => deleteApp(app.id);

&nbsp;       document.getElementById('detail-view').classList.add('open');

&nbsp;   }



&nbsp;   window.closeDetail = () => document.getElementById('detail-view').classList.remove('open');



&nbsp;   async function deleteApp(id) {

&nbsp;       if (!confirm("Are you certain you want to delete this app? This cannot be undone.")) return;

&nbsp;       await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'apps', id));

&nbsp;       closeDetail();

&nbsp;   }



&nbsp;   window.openGetModal = (id) => {

&nbsp;       currentApp = apps.find(a => a.id === id);

&nbsp;       const modal = document.getElementById('modal-overlay');

&nbsp;       const content = document.getElementById('modal-content');

&nbsp;       

&nbsp;       content.innerHTML = `

&nbsp;           <h2 class="text-2xl font-black mb-2">Install ${currentApp.name}</h2>

&nbsp;           <p class="text-gray-400 text-sm mb-8">Choose your installation method.</p>

&nbsp;           <div class="space-y-4">

&nbsp;               <button onclick="downloadApp('win')" class="btn-primary bg-blue-600 text-white flex items-center justify-center gap-3">

&nbsp;                   <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M0 3.449L9.75 2.1V11.719H0V3.449zm0 9.13l9.75.051V21.9L0 20.42V12.579zM11.25 1.9L24 0V11.719H11.25V1.9zm12.75 10.73V24l-12.75-1.9v-9.451l12.75.081z"/></svg>

&nbsp;                   Windows Link

&nbsp;               </button>

&nbsp;               <button onclick="downloadApp('mac')" class="btn-primary bg-gray-900 text-white flex items-center justify-center gap-3">

&nbsp;                   <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z"/></svg>

&nbsp;                   macOS Link

&nbsp;               </button>

&nbsp;               <button onclick="runApp()" class="btn-primary bg-gray-100 !text-gray-900 font-black border-2 border-gray-200">

&nbsp;                   Run in App Browser

&nbsp;               </button>

&nbsp;               <p class="text-\[11px] text-gray-400 mt-6 leading-relaxed italic">

&nbsp;                   <b>iPad Note:</b> Use 'Run in App Browser' then tap Share > Add to Home Screen.

&nbsp;               </p>

&nbsp;           </div>

&nbsp;       `;

&nbsp;       modal.style.display = 'flex';

&nbsp;   }



&nbsp;   window.downloadApp = (platform) => {

&nbsp;       const url = currentApp.appUrl;

&nbsp;       if (url.startsWith('data:')) {

&nbsp;           const a = document.createElement('a'); a.href = url; a.download = currentApp.name + ".html"; a.click();

&nbsp;       } else {

&nbsp;           const ext = platform === 'win' ? '.url' : '.webloc';

&nbsp;           const content = platform === 'win' ? `\[InternetShortcut]\\nURL=${url}` : `<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><plist version="1.0"><dict><key>URL</key><string>${url}</string></dict></plist>`;

&nbsp;           const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob(\[content])); a.download = currentApp.name + ext; a.click();

&nbsp;       }

&nbsp;       document.getElementById('modal-overlay').style.display = 'none';

&nbsp;   }



&nbsp;   window.runApp = () => {

&nbsp;       document.getElementById('modal-overlay').style.display = 'none';

&nbsp;       document.getElementById('runner-title').innerText = currentApp.name.toUpperCase();

&nbsp;       document.getElementById('runner-frame').src = currentApp.appUrl;

&nbsp;       document.getElementById('app-runner').style.display = 'flex';

&nbsp;   }



&nbsp;   window.closeAppRunner = () => {

&nbsp;       document.getElementById('runner-frame').src = "";

&nbsp;       document.getElementById('app-runner').style.display = 'none';

&nbsp;   }



&nbsp;   window.openAccount = () => {

&nbsp;       if (!user || user.isAnonymous) return openAuth();

&nbsp;       openProfile();

&nbsp;   }



&nbsp;   window.openAuth = () => {

&nbsp;       const modal = document.getElementById('modal-overlay');

&nbsp;       const content = document.getElementById('modal-content');

&nbsp;       content.innerHTML = `

&nbsp;           <div id="auth-box">

&nbsp;               <h2 class="text-3xl font-black mb-3 leading-tight text-center">Isaahi Account</h2>

&nbsp;               <p class="text-gray-400 mb-8 text-sm text-center">Connect to publish and manage apps.</p>

&nbsp;               <input id="auth-email" type="email" placeholder="Email Address">

&nbsp;               <input id="auth-pass" type="password" placeholder="Password">

&nbsp;               <button id="auth-btn" class="btn-primary bg-blue-600 text-white mt-4 shadow-xl shadow-blue-100">Sign In</button>

&nbsp;               <button onclick="toggleAuthMode(this)" class="w-full text-blue-600 text-xs mt-8 font-black uppercase tracking-widest">Create New Profile</button>

&nbsp;           </div>

&nbsp;       `;

&nbsp;       document.getElementById('auth-btn').onclick = () => handleAuthAction('login');

&nbsp;       modal.style.display = 'flex';

&nbsp;   }



&nbsp;   window.toggleAuthMode = (btn) => {

&nbsp;       const h2 = btn.parentElement.querySelector('h2');

&nbsp;       const actionBtn = document.getElementById('auth-btn');

&nbsp;       if (h2.innerText === 'Isaahi Account') {

&nbsp;           h2.innerText = 'Join Isaahi';

&nbsp;           const nameInput = document.createElement('input');

&nbsp;           nameInput.id = 'auth-name';

&nbsp;           nameInput.placeholder = 'Public Name';

&nbsp;           btn.parentElement.insertBefore(nameInput, document.getElementById('auth-email'));

&nbsp;           actionBtn.innerText = 'Create Account';

&nbsp;           actionBtn.onclick = () => handleAuthAction('signup');

&nbsp;           btn.innerText = 'Switch to Log In';

&nbsp;       } else {

&nbsp;           h2.innerText = 'Isaahi Account';

&nbsp;           document.getElementById('auth-name')?.remove();

&nbsp;           actionBtn.innerText = 'Sign In';

&nbsp;           actionBtn.onclick = () => handleAuthAction('login');

&nbsp;           btn.innerText = "Create New Profile";

&nbsp;       }

&nbsp;   }



&nbsp;   async function handleAuthAction(mode) {

&nbsp;       const email = document.getElementById('auth-email').value;

&nbsp;       const pass = document.getElementById('auth-pass').value;

&nbsp;       try {

&nbsp;           if (mode === 'signup') {

&nbsp;               const name = document.getElementById('auth-name').value;

&nbsp;               const cred = await createUserWithEmailAndPassword(auth, email, pass);

&nbsp;               await setDoc(doc(db, 'artifacts', appId, 'users', cred.user.uid, 'profile', 'data'), { name, email });

&nbsp;           } else {

&nbsp;               await signInWithEmailAndPassword(auth, email, pass);

&nbsp;           }

&nbsp;           document.getElementById('modal-overlay').style.display = 'none';

&nbsp;       } catch (e) { alert(e.message); }

&nbsp;   }



&nbsp;   window.openProfile = async () => {

&nbsp;       const pDoc = await getDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'data'));

&nbsp;       const profile = pDoc.data();

&nbsp;       const modal = document.getElementById('modal-overlay');

&nbsp;       const content = document.getElementById('modal-content');

&nbsp;       content.innerHTML = `

&nbsp;           <div class="text-center p-2">

&nbsp;               <div class="w-24 h-24 bg-blue-600 rounded-\[32px] mx-auto mb-6 flex items-center justify-center text-white text-4xl font-black shadow-2xl shadow-blue-200">${profile?.name?.\[0] || 'U'}</div>

&nbsp;               <h2 class="text-2xl font-black">${profile?.name || 'Developer'}</h2>

&nbsp;               <p class="text-gray-400 text-base mb-12 font-medium">${user.email}</p>

&nbsp;               <button id="logout-btn" class="btn-primary bg-red-50 text-red-600 font-black tracking-widest text-xs uppercase border border-red-100">Sign Out</button>

&nbsp;           </div>

&nbsp;       `;

&nbsp;       document.getElementById('logout-btn').onclick = handleLogout;

&nbsp;       modal.style.display = 'flex';

&nbsp;   }



&nbsp;   window.handleLogout = async () => {

&nbsp;       await signOut(auth);

&nbsp;       document.getElementById('modal-overlay').style.display = 'none';

&nbsp;       router('today');

&nbsp;   }



&nbsp;   function setupPublishForm() {

&nbsp;       const fileIn = document.getElementById('p-file');

&nbsp;       fileIn.onchange = (e) => {

&nbsp;           const file = e.target.files\[0];

&nbsp;           const reader = new FileReader();

&nbsp;           reader.onload = (ev) => {

&nbsp;               uploadedFile = ev.target.result;

&nbsp;               document.getElementById('file-status').innerText = "SELECTED: " + file.name.toUpperCase();

&nbsp;               document.getElementById('file-status').className = 'text-blue-600 font-black text-\[11px] tracking-widest';

&nbsp;           };

&nbsp;           reader.readAsDataURL(file);

&nbsp;       };



&nbsp;       document.getElementById('publish-form').onsubmit = async (e) => {

&nbsp;           e.preventDefault();

&nbsp;           const pDoc = await getDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'data'));

&nbsp;           const pData = pDoc.data();

&nbsp;           

&nbsp;           const appData = {

&nbsp;               name: document.getElementById('p-name').value,

&nbsp;               description: document.getElementById('p-desc').value,

&nbsp;               appUrl: uploadedFile || document.getElementById('p-url').value,

&nbsp;               icon: document.getElementById('p-icon').value,

&nbsp;               color: document.getElementById('p-color').value,

&nbsp;               developerName: pData?.name || 'Isaahi Dev',

&nbsp;               ownerId: user.uid,

&nbsp;               createdAt: serverTimestamp()

&nbsp;           };



&nbsp;           if (!appData.appUrl) return alert("Select a file or provide a link.");

&nbsp;           const btn = e.target.querySelector('button');

&nbsp;           btn.disabled = true; btn.innerText = "PUBLISHING...";

&nbsp;           await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'apps'), appData);

&nbsp;           uploadedFile = null;

&nbsp;           router('today');

&nbsp;       };

&nbsp;   }



&nbsp;   init();

</script>

</body>

</html>

